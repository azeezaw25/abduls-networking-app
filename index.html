<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abdul's Networking App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Load FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- GLOBAL STYLES --- */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 1px solid #e5e7eb; }
        .btn-primary { transition: all 0.2s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(59, 130, 246, 0.4); }

        /* --- ANIMATIONS --- */
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* --- SWITCHING DEMO --- */
        .node { width: 40px; height: 40px; background: #e5e7eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #9ca3af; position: relative; z-index: 10; }
        .node.active { background: #3b82f6; color: white; border-color: #2563eb; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .packet { width: 12px; height: 12px; background: #ef4444; border-radius: 50%; position: absolute; z-index: 20; display: none; }

        /* --- HISTORY BOOK THEME --- */
        .history-page {
            background-color: #fcfbf9;
            background-image: radial-gradient(#d1d1d1 1px, transparent 1px);
            background-size: 20px 20px;
            color: #2c241b;
        }
        .history-title { font-family: 'Playfair Display', serif; }
        .history-text { font-family: 'Crimson+Text', serif; font-size: 1.1rem; line-height: 1.7; color: #3a3228; }
        .drop-cap::first-letter { float: left; font-family: 'Playfair Display', serif; font-size: 3.5rem; line-height: 3rem; padding-right: 0.5rem; color: #b45309; font-weight: 700; }

        /* CSS for Topologies Illustration */
        .topology-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            min-height: 150px;
            position: relative;
        }
        .topo-node {
            width: 20px;
            height: 20px;
            background: #10b981; /* Emerald */
            border-radius: 50%;
            border: 2px solid #059669;
            position: absolute;
            z-index: 5;
        }
        .topo-center {
            width: 30px;
            height: 30px;
            background: #3b82f6; /* Blue */
            border-radius: 50%;
            border: 2px solid #2563eb;
            z-index: 10;
        }
        .topo-line {
            position: absolute;
            background: #9ca3af;
            height: 2px;
            z-index: 1;
        }

        /* Terminal Style for Telnet */
        .terminal {
            background-color: #000000;
            color: #00ff00;
            font-family: 'JetBrains Mono', monospace;
            border-radius: 8px;
            padding: 1rem;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #00ff00;
        }
        .terminal-prompt::before {
            content: "user@remote-server:~> ";
            color: #00ff00;
        }
    </style>

    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        let db, auth;

        async function initFirebase() {
            if (!firebaseConfig) return;
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                onAuthStateChanged(auth, (user) => {
                    if (user) window.userId = user.uid;
                    else signInAnonymously(auth);
                });
            } catch (e) { console.error("Firebase init failed", e); }
        }
        window.logProgress = async function(page) {
            if (db && window.userId) {
                try {
                    await setDoc(doc(db, `/artifacts/${appId}/users/${window.userId}/logs/${Date.now()}`), { page, timestamp: new Date().toISOString() });
                } catch(e) {}
            }
        }
        window.addEventListener('load', initFirebase);
    </script>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col items-center">

    <div id="app" class="w-full max-w-5xl"></div>

    <script>
        // --- DATA ---
        const layersData = [
            {},
            { id: 1, name: "Physical", desc: "Transmits raw bits over a medium.", action: "Send Bits" },
            { id: 2, name: "Data Link", desc: "MAC Addressing & Error detection.", action: "Send Frame" },
            { id: 3, name: "Network", desc: "Routing & Logical IP Addressing.", action: "Route Packet" },
            { id: 4, name: "Transport", desc: "End-to-end delivery & segmentation (TCP/UDP).", action: "Segment Data" },
            { id: 5, name: "Session", desc: "Manages sessions between applications.", action: "Start Session" },
            { id: 6, name: "Presentation", desc: "Data translation, encryption, compression.", action: "Encrypt" },
            { id: 7, name: "Application", desc: "Network services for end-users (HTTP, FTP).", action: "HTTP GET" }
        ];

        const devicesData = {
            nic: { n: 'NIC', icon: 'fa-microchip', d: 'Connects a computer to a network medium.', layer: 'Layer 1 & 2' },
            switch: { n: 'Switch', icon: 'fa-shuffle', d: 'Forwards frames based on MAC addresses within a LAN.', layer: 'Layer 2' },
            router: { n: 'Router', icon: 'fa-route', d: 'Connects and routes data between different networks (WANs/LANs).', layer: 'Layer 3' },
            modem: { n: 'Modem', icon: 'fa-signal', d: 'Modulates digital data into analog signals and vice-versa.', layer: 'Layer 1' },
            gateway: { n: 'Gateway', icon: 'fa-door-open', d: 'Acts as an entry/exit point, translating protocols between disparate networks.', layer: 'All Layers' }
        };

        const termsData = {
            bandwidth: { name: "Bandwidth", desc: "The maximum data transfer rate of a network or Internet connection, usually measured in bits per second (bps)." },
            throughput: { name: "Throughput", desc: "The actual amount of data successfully delivered over a period of time. Always less than or equal to bandwidth." },
            simplex: { name: "Simplex", desc: "Communication is unidirectional (one-way only). Example: Traditional radio/TV broadcast." },
            halfDuplex: { name: "Half-Duplex", desc: "Communication is bidirectional, but only one direction at a time. Example: Walkie-talkie." },
            fullDuplex: { name: "Full-Duplex", desc: "Communication is bidirectional simultaneously (two-way at once). Example: Telephone conversation." }
        };


        let state = {
            page: 'welcome',
            duplexMode: 'simplex',
            tcpState: 'closed', // For Layer 4 simulation
            mediaType: 'Wired', // For Media section
            geoScope: 'LAN', // For Geo section
            selectedTopo: 'Star', // For Topologies section
        };

        // --- RENDER ENGINE ---
        function render() {
            const app = document.getElementById('app');
            if(window.logProgress) window.logProgress(state.page);

            // Container Styles
            let containerClass = "bg-white rounded-xl card p-6 md:p-10 shadow-xl min-h-[600px]";
            if(state.page === 'history') containerClass = "shadow-2xl rounded-sm overflow-hidden min-h-[600px] w-full max-w-4xl";

            app.className = containerClass;
            app.innerHTML = '';

            // Navigation
            if (state.page !== 'welcome') {
                const isHistory = state.page === 'history';
                const navColor = isHistory ? "text-amber-900 border-amber-900/20" : "text-blue-600 border-blue-100";

                // --- Navigation Logic START ---
                let backAction = 'welcome';
                let backText = 'Main Menu';

                if (state.page.startsWith('layer')) {
                    backAction = 'osi';
                    backText = 'OSI Model';
                } else if (state.page.startsWith('device_')) {
                    backAction = 'devices';
                    backText = 'Network Devices';
                } else if (['media', 'geo_class', 'topologies', 'protocols', 'web_tech', 'security', 'telnet'].includes(state.page)) {
                    backAction = 'deep_dive';
                    backText = 'Deep Dive Topics';
                } else if (state.page === 'deep_dive') {
                    backAction = 'welcome';
                    backText = 'Main Menu';
                } else if (state.page === 'history') {
                    backAction = 'welcome';
                    backText = 'Return to Library';
                }

                // --- Navigation Logic END ---

                let titleText = state.page.toUpperCase().replace('_', ' ');
                if (state.page.startsWith('layer')) {
                    const layerId = parseInt(state.page.replace('layer',''));
                    titleText = `OSI LAYER ${layerId}: ${layersData[layerId].name.toUpperCase()}`;
                } else if (state.page.startsWith('device')) {
                    const deviceKey = state.page.split('_')[1];
                    const deviceName = devicesData[deviceKey] ? devicesData[deviceKey].n.toUpperCase() : 'UNKNOWN DEVICE';
                    titleText = deviceName;
                }

                app.innerHTML += `
                    <div class="flex justify-between items-center mb-6 pb-4 border-b ${navColor} ${isHistory ? 'bg-[#fcfbf9] px-8 pt-8 mb-0' : ''}">
                        <button onclick="nav('${backAction}')" class="font-bold flex items-center hover:opacity-75">
                            <i class="fas fa-arrow-left mr-2"></i> ${backText}
                        </button>
                        <span class="text-xs opacity-50 uppercase tracking-widest font-bold">${titleText}</span>
                    </div>
                `;
            }

            // Router
            let content = '';
            switch(state.page) {
                case 'welcome': content = renderWelcome(); break;
                case 'osi': content = renderOSI(); break;
                case 'devices': content = renderDevices(); break;
                case 'ip': content = renderIP(); break;
                case 'switching': content = renderSwitching(); break;
                case 'terms': content = renderTerms(); break;
                case 'history': content = renderHistory(); break;
                // --- NEW DEEP DIVE ROUTING ---
                case 'deep_dive': content = renderDeepDive(); break;
                case 'media': content = renderMedia(); break;
                case 'geo_class': content = renderGeoClass(); break;
                case 'topologies': content = renderTopologies(); break;
                case 'protocols': content = renderProtocols(); break;
                case 'web_tech': content = renderWebTech(); break;
                case 'security': content = renderSecurity(); break;
                case 'telnet': content = renderTelnet(); break; // New Telnet page
                // --- END NEW ROUTING ---
                case 'device_nic':
                case 'device_switch':
                case 'device_router':
                case 'device_modem':
                case 'device_gateway':
                    content = renderDevice(state.page.split('_')[1]);
                    break;
                default:
                    if (state.page.startsWith('layer')) {
                        content = renderLayer(parseInt(state.page.replace('layer','')));
                    } else {
                        content = renderWelcome();
                    }
                    break;
            }
            app.innerHTML += content;
        }

        window.nav = function(p) { state.page = p; render(); }

        // --- CORE PAGES (Restored) ---

        function renderWelcome() {
            return `
                <div class="text-center py-10">
                    <div class="inline-block p-4 rounded-full bg-blue-100 text-blue-600 mb-6 text-4xl"><i class="fas fa-network-wired"></i></div>
                    <h1 class="text-5xl font-extrabold text-gray-800 mb-4">Network Navigator</h1>
                    <p class="text-xl text-gray-600 mb-12 max-w-2xl mx-auto">Grade 12 Computer Science â€¢ Interactive Networking Guide</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 max-w-4xl mx-auto">
                        ${menuBtn('osi', 'OSI Model', 'The 7 Layers architecture', 'fa-layer-group', 'blue')}
                        ${menuBtn('devices', 'Network Devices', 'Hardware components', 'fa-server', 'green')}
                        ${menuBtn('ip', 'IP Addressing', 'Classes & Subnetting', 'fa-globe', 'purple')}
                        ${menuBtn('switching', 'Switching Tech', 'Circuit vs Packet', 'fa-random', 'orange')}
                        ${menuBtn('deep_dive', 'Networking Deep Dive', 'Advanced Concepts & Security', 'fa-brain', 'indigo')}
                        ${menuBtn('terms', 'Terminologies', 'Bandwidth & Modes', 'fa-book', 'teal')}
                        ${menuBtn('history', 'History & Future', 'Evolution of Net', 'fa-landmark', 'amber')}
                    </div>
                </div>
            `;
        }

        function menuBtn(id, title, sub, icon, color) {
            const colors = {
                blue: 'bg-blue-50 text-blue-600 border-blue-200 hover:bg-blue-600 hover:text-white',
                green: 'bg-green-50 text-green-600 border-green-200 hover:bg-green-600 hover:text-white',
                purple: 'bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-600 hover:text-white',
                orange: 'bg-orange-50 text-orange-600 border-orange-200 hover:bg-orange-600 hover:text-white',
                teal: 'bg-teal-50 text-teal-600 border-teal-200 hover:bg-teal-600 hover:text-white',
                amber: 'bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-700 hover:text-white',
                indigo: 'bg-indigo-50 text-indigo-600 border-indigo-200 hover:bg-indigo-600 hover:text-white',
            };
            return `
                <button onclick="nav('${id}')" class="${colors[color]} border p-6 rounded-xl text-left transition-all btn-primary group">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas ${icon} text-2xl group-hover:text-white transition-colors"></i>
                        <i class="fas fa-chevron-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    </div>
                    <h3 class="font-bold text-lg">${title}</h3>
                    <p class="text-xs opacity-70 group-hover:text-gray-100">${sub}</p>
                </button>
            `;
        }

        function renderOSI() {
            const list = layersData.slice(1).reverse().map(l => `
                <button onclick="nav('layer${l.id}')" class="w-full bg-white p-4 rounded-lg border-l-4 border-blue-500 shadow-sm hover:shadow-md transition-all text-left mb-3 group">
                    <span class="text-xs font-bold text-blue-500 uppercase">Layer ${l.id}</span>
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800">${l.name} Layer</h3>
                        <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity text-blue-500"></i>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">${l.desc}</p>
                </button>
            `).join('');
            return `<div class="fade-in-up"><h2 class="text-3xl font-bold text-gray-800 mb-6">The OSI Model</h2>${list}</div>`;
        }

        function renderLayer(id) {
            const layer = layersData[id];
            if (!layer) return `<div class="p-6 text-red-600">Layer not found.</div>`;

            const interaction = getLayerInteraction(id, layer);

            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-3">${layer.name} Layer (L${id})</h2>
                    <p class="text-lg text-blue-600 mb-8">${layer.desc}</p>

                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="md:col-span-2 bg-gray-50 p-6 rounded-xl border-l-4 border-blue-500">
                            <h3 class="font-bold text-xl mb-3">Key Functions</h3>
                            <ul class="list-disc ml-5 space-y-2 text-sm text-gray-700">
                                ${id === 7 ? `<li>Provides interface for end-user applications (e.g., HTTP, FTP, DNS).</li>` : ''}
                                ${id === 6 ? `<li>Data format conversion (ASCII to EBCDIC).</li><li>Encryption and Decryption.</li>` : ''}
                                ${id === 5 ? `<li>Establishes, manages, and terminates sessions between applications.</li>` : ''}
                                ${id === 4 ? `<li>Segmentation/Reassembly (breaking data into segments).</li><li>Connection management (TCP Three-Way Handshake) and reliability (TCP/UDP).</li>` : ''}
                                ${id === 3 ? `<li>Logical addressing (IP Addressing).</li><li>Routing (determining the best path).</li>` : ''}
                                ${id === 2 ? `<li>Physical addressing (MAC Addressing).</li><li>Error detection and control.</li>` : ''}
                                ${id === 1 ? `<li>Physical medium (cables, connectors).</li><li>Signal type (electrical, optical).</li>` : ''}
                            </ul>
                        </div>
                        <div class="bg-blue-100 p-6 rounded-xl">
                            <h3 class="font-bold text-xl mb-3 text-blue-800">Data Unit</h3>
                            <p class="text-3xl font-extrabold text-blue-600">
                                ${id === 7 || id === 6 || id === 5 ? 'Data' : ''}
                                ${id === 4 ? 'Segment/Datagram' : ''}
                                ${id === 3 ? 'Packet' : ''}
                                ${id === 2 ? 'Frame' : ''}
                                ${id === 1 ? 'Bit' : ''}
                            </p>
                            <p class="text-xs mt-3 text-blue-800">The name of the data unit at this layer.</p>
                        </div>
                    </div>

                    <h3 class="font-bold text-2xl text-gray-800 mt-10 mb-4">Interactive Demo: ${layer.action}</h3>
                    <div class="bg-white p-6 rounded-xl border border-gray-200">
                        ${interaction}
                    </div>
                </div>
            `;
        }

        function getLayerInteraction(id, layer) {
            switch(id) {
                case 7: return `
                    <p class="mb-4">Simulate a client requesting a web page from a server using **HTTP**.</p>
                    <div class="flex items-center space-x-4">
                        <button onclick="simulateHTTP('l7-output')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700"><i class="fas fa-globe mr-2"></i>Send HTTP Request</button>
                        <span id="l7-output" class="text-sm italic text-gray-600">Awaiting request...</span>
                    </div>
                `;
                case 6: return `
                    <p class="mb-4">Simulate **Encryption** before data is sent to Layer 5.</p>
                    <input type="text" id="l6-input" class="border p-2 rounded w-full md:w-1/2 mb-3" placeholder="Enter confidential data...">
                    <button onclick="encryptText('l6-input', 'l6-output')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700">Encrypt (Caesar Cipher)</button>
                    <p class="mt-4 text-sm"><strong class="text-gray-800">Encrypted Data:</strong> <span id="l6-output" class="text-green-600 font-mono"></span></p>
                `;
                case 5: return `
                    <p class="mb-4">Session management ensures that both client and server are ready to communicate.</p>
                    <div class="flex items-center space-x-4">
                        <button onclick="toggleSession('l5-output')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700"><i class="fas fa-handshake mr-2"></i>Establish/Terminate Session</button>
                        <span id="l5-output" class="text-sm italic text-red-600 font-bold">Session: CLOSED</span>
                    </div>
                `;
                case 4: return `
                    <p class="mb-4">Choose a protocol (TCP for reliable, UDP for fast) and simulate a data transfer.</p>
                    <div class="flex space-x-4">
                        <button onclick="simulateTCP('l4-output')" class="bg-red-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-700"><i class="fas fa-check-circle mr-2"></i>Simulate TCP (Reliable)</button>
                        <button onclick="simulateUDP('l4-output')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700"><i class="fas fa-bolt mr-2"></i>Simulate UDP (Unreliable)</button>
                    </div>
                    <p class="mt-4 text-sm"><strong class="text-gray-800">Status:</strong> <span id="l4-output" class="text-gray-600 font-mono">Ready.</span></p>
                `;
                case 3: return `
                    <p class="mb-4">Layer 3 (Network) handles **Routing** using **IP Addresses**.</p>
                    <input type="text" id="l3-input" class="border p-2 rounded w-full md:w-1/2 mb-3 font-mono" placeholder="192.168.1.1">
                    <button onclick="lookupRoute('l3-input', 'l3-output')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700"><i class="fas fa-route mr-2"></i>Route Packet</button>
                    <p class="mt-4 text-sm"><strong class="text-gray-800">Next Hop:</strong> <span id="l3-output" class="text-gray-600 font-mono"></span></p>
                `;
                case 2: return `
                    <p class="mb-4">Layer 2 (Data Link) creates a **Frame** with **MAC Addresses**.</p>
                    <div class="space-y-3">
                        <p class="text-sm font-mono text-gray-700">Source MAC: <span id="l2-src-mac" class="text-blue-600">${generateRandomMAC()}</span></p>
                        <p class="text-sm font-mono text-gray-700">Destination MAC: <span id="l2-dst-mac" class="text-red-600">${generateRandomMAC()}</span></p>
                    </div>
                    <button onclick="createFrame('l2-output')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 mt-4"><i class="fas fa-box mr-2"></i>Create Ethernet Frame</button>
                    <p class="mt-4 text-sm"><strong class="text-gray-800">Frame:</strong> <span id="l2-output" class="text-gray-600 font-mono text-xs block break-all"></span></p>
                `;
                case 1: return `
                    <p class="mb-4">Layer 1 (Physical) sends raw **Bits** (0s and 1s) as electrical signals.</p>
                    <div class="flex items-center space-x-4">
                        <button onclick="transmitBits('l1-output')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700"><i class="fas fa-ethernet mr-2"></i>Transmit 10 Bits</button>
                        <span id="l1-output" class="text-xl font-mono text-gray-800">...</span>
                    </div>
                `;
                default: return `<p>No interaction available for this layer.</p>`;
            }
        }

        function renderDevices() {
            const list = Object.keys(devicesData).map(key => {
                const d = devicesData[key];
                return `
                    <button onclick="nav('device_${key}')" class="bg-white p-4 rounded-lg border-l-4 border-green-500 shadow-sm hover:shadow-md transition-all text-left mb-3 group">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <i class="fas ${d.icon} text-2xl mr-3 text-green-600"></i>
                                <h3 class="text-xl font-bold text-gray-800">${d.n}</h3>
                            </div>
                            <span class="text-xs font-bold text-green-500 uppercase">${d.layer}</span>
                        </div>
                        <p class="text-sm text-gray-500 mt-1">${d.d}</p>
                    </button>
                `;
            }).join('');
            return `<div class="fade-in-up"><h2 class="text-3xl font-bold text-gray-800 mb-6">Network Hardware Devices</h2>${list}</div>`;
        }

        function renderDevice(key) {
            const device = devicesData[key];
            const interaction = getDeviceInteraction(key, device);

            return `
                <div class="fade-in-up">
                    <div class="flex items-center space-x-4 mb-4">
                        <i class="fas ${device.icon} text-5xl text-green-600"></i>
                        <h2 class="text-3xl font-bold text-gray-800">${device.n}</h2>
                    </div>
                    <p class="text-lg text-gray-600 mb-6">${device.d}</p>

                    <div class="grid md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-green-50 p-4 rounded-xl">
                            <h3 class="font-bold text-green-800">Primary OSI Layer</h3>
                            <p class="text-2xl font-extrabold text-green-600">${device.layer}</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-xl">
                            <h3 class="font-bold text-green-800">Addressing Used</h3>
                            <p class="text-lg font-extrabold text-green-600">
                                ${key === 'router' || key === 'gateway' ? 'IP (Logical)' : ''}
                                ${key === 'switch' || key === 'nic' ? 'MAC (Physical)' : ''}
                                ${key === 'modem' ? 'None' : ''}
                            </p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-xl">
                            <h3 class="font-bold text-green-800">Data Unit Handled</h3>
                            <p class="text-lg font-extrabold text-green-600">
                                ${key === 'router' ? 'Packet' : ''}
                                ${key === 'switch' ? 'Frame' : ''}
                                ${key === 'nic' ? 'Frame/Bit' : ''}
                                ${key === 'modem' ? 'Bit' : ''}
                                ${key === 'gateway' ? 'Data/Segment/Packet' : ''}
                            </p>
                        </div>
                    </div>

                    <h3 class="font-bold text-2xl text-gray-800 mt-10 mb-4">Interactive Demo</h3>
                    <div class="bg-white p-6 rounded-xl border border-gray-200">
                        ${interaction}
                    </div>
                </div>
            `;
        }

        function getDeviceInteraction(key, device) {
            switch(key) {
                case 'nic': return `
                    <p class="mb-4">The NIC is assigned a **MAC Address** at the factory. Click to see a random example:</p>
                    <button onclick="generateMAC('nic-mac-output')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700"><i class="fas fa-microchip mr-2"></i>Generate MAC</button>
                    <p class="mt-4 text-lg font-mono text-gray-800"><span id="nic-mac-output">${generateRandomMAC()}</span></p>
                `;
                case 'switch': return `
                    <p class="mb-4">A Switch learns which **MAC Addresses** are connected to which **Port**. This is the **MAC Address Table**.</p>
                    <button onclick="learnMAC('switch-output')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700"><i class="fas fa-shuffle mr-2"></i>Learn New Device</button>
                    <div class="mt-4 bg-gray-100 p-3 rounded-md max-h-40 overflow-y-auto">
                        <p class="font-bold text-sm text-gray-700 mb-1">MAC Address Table:</p>
                        <div id="switch-output">No entries yet.</div>
                    </div>
                `;
                case 'router': return `
                    <p class="mb-4">A Router determines the **best path** (route) for a **Packet** using its **IP Address**.</p>
                    <input type="text" id="router-ip-input" class="border p-2 rounded w-full md:w-1/2 mb-3 font-mono" placeholder="Destination IP (e.g., 8.8.8.8)">
                    <button onclick="routePacket('router-ip-input', 'router-output')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700"><i class="fas fa-route mr-2"></i>Find Route</button>
                    <p class="mt-4 text-sm"><strong class="text-gray-800">Routing Decision:</strong> <span id="router-output" class="text-gray-600 font-mono"></span></p>
                `;
                case 'modem': return `
                    <p class="mb-4">A Modem **MO**dulates (Digital to Analog) and **DEM**odulates (Analog to Digital) signals to cross phone lines.</p>
                    <div class="flex items-center space-x-4">
                        <span id="modem-status" class="text-xl font-bold text-blue-600">Digital Signal</span>
                        <i id="modem-icon" class="fas fa-arrow-right text-2xl text-gray-500"></i>
                        <span id="modem-signal" class="text-xl font-bold text-red-600">Analog Signal (Line)</span>
                    </div>
                    <button onclick="toggleModem('modem-status', 'modem-icon', 'modem-signal')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 mt-4"><i class="fas fa-exchange-alt mr-2"></i>Toggle Modulation/Demodulation</button>
                `;
                case 'gateway': return `
                    <p class="mb-4">A Gateway translates protocols between two disparate networks, allowing them to communicate (e.g., email service protocol translation).</p>
                    <div class="flex items-center space-x-4">
                        <span id="gateway-input" class="text-xl font-bold text-purple-600">POP3</span>
                        <i class="fas fa-long-arrow-alt-right text-3xl text-gray-500"></i>
                        <span id="gateway-output" class="text-xl font-bold text-purple-600">IMAP</span>
                    </div>
                    <button onclick="translateProtocol('gateway-output')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 mt-4"><i class="fas fa-language mr-2"></i>Translate Protocol</button>
                `;
                default: return `<p>No interaction available.</p>`;
            }
        }

        function renderIP() {
            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">IP Addressing & Classes</h2>
                    <p class="text-lg text-gray-600 mb-8">IP addresses are the logical addresses (Layer 3) used for routing packets across the Internet.</p>

                    <div class="bg-purple-50 p-6 rounded-xl mb-8 border-l-4 border-purple-500">
                        <h3 class="font-bold text-xl text-purple-800 mb-3">IP Classes (Classful Addressing)</h3>
                        <div class="space-y-3 text-sm text-gray-700">
                            <p><strong>Class A:</strong> First octet 1-126. Used for very large networks. (Default Mask: 255.0.0.0)</p>
                            <p><strong>Class B:</strong> First octet 128-191. Used for medium-sized networks. (Default Mask: 255.255.0.0)</p>
                            <p><strong>Class C:</strong> First octet 192-223. Used for small-sized networks (most common). (Default Mask: 255.255.255.0)</p>
                            <p><strong>Class D:</strong> First octet 224-239. Reserved for multicast addressing.</p>
                            <p><strong>Class E:</strong> First octet 240-255. Reserved for experimental purposes.</p>
                        </div>
                    </div>

                    <h3 class="font-bold text-2xl text-gray-800 mb-4">Interactive: IP Class Checker</h3>
                    <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4">
                        <input type="text" id="ip-input" class="border p-3 rounded-lg w-full md:w-2/3 font-mono text-lg" placeholder="Enter an IP Address (e.g., 10.0.0.1 or 192.168.1.1)">
                        <button onclick="checkIP('ip-input', 'ip-output')" class="bg-purple-600 text-white px-4 py-3 rounded-lg font-bold hover:bg-purple-700 w-full md:w-1/3"><i class="fas fa-search mr-2"></i>Check Class</button>
                    </div>
                    <p class="mt-6 text-xl font-bold"><span id="ip-output" class="text-gray-700">Result will appear here.</span></p>
                </div>
            `;
        }

        function renderSwitching() {
             setTimeout(initSwitchingCanvas, 100);
             return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Data Switching Techniques</h2>

                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <!-- Circuit Switching Info -->
                        <div class="bg-orange-50 p-6 rounded-xl border border-orange-200">
                            <h3 class="font-bold text-xl text-orange-800 mb-2"><i class="fas fa-plug mr-2"></i>Circuit Switching</h3>
                            <p class="text-sm text-gray-700 mb-4">Dedicated path established before data transfer. Path remains reserved for the entire session.</p>
                            <ul class="text-sm list-disc pl-5 text-gray-600">
                                <li><strong>Pros:</strong> No congestion, fixed bandwidth.</li>
                                <li><strong>Cons:</strong> Wastes resources during silence.</li>
                                <li><strong>Example:</strong> Traditional Telephone Networks.</li>
                            </ul>
                        </div>
                        <!-- Packet Switching Info -->
                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                            <h3 class="font-bold text-xl text-blue-800 mb-2"><i class="fas fa-box-open mr-2"></i>Packet Switching</h3>
                            <p class="text-sm text-gray-700 mb-4">Data broken into packets. Each packet travels independently via best route. No dedicated path.</p>
                            <ul class="text-sm list-disc pl-5 text-gray-600">
                                <li><strong>Pros:</strong> Efficient use of bandwidth.</li>
                                <li><strong>Cons:</strong> Packets may arrive out of order.</li>
                                <li><strong>Example:</strong> The Internet (TCP/IP).</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Interactive Simulation -->
                    <div class="bg-gray-900 rounded-xl p-6 text-white relative overflow-hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-lg">Live Simulation</h3>
                            <div class="space-x-2">
                                <button onclick="runSwitchSim('circuit')" class="bg-orange-600 hover:bg-orange-500 px-4 py-1 rounded text-sm font-bold">Simulate Circuit</button>
                                <button onclick="runSwitchSim('packet')" class="bg-blue-600 hover:bg-blue-500 px-4 py-1 rounded text-sm font-bold">Simulate Packet</button>
                            </div>
                        </div>

                        <!-- Visualization Area -->
                        <div id="sim-area" class="h-64 relative bg-gray-800 rounded-lg border border-gray-700">
                            <div class="absolute inset-0 flex items-center justify-between px-10">
                                <div class="node active" id="node-a">A</div>
                                <!-- Middle Nodes -->
                                <div class="flex flex-col space-y-8">
                                    <div class="node" id="node-1">1</div>
                                    <div class="node" id="node-2">2</div>
                                    <div class="node" id="node-3">3</div>
                                </div>
                                <div class="node active" id="node-b">B</div>
                            </div>
                            <div id="sim-status" class="absolute bottom-2 left-0 right-0 text-center text-xs text-gray-400">Select a mode to start</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTerms() {
            const termList = Object.keys(termsData).map(key => {
                const term = termsData[key];
                return `
                    <div class="bg-teal-50 p-4 rounded-lg border-l-4 border-teal-500">
                        <h3 class="font-bold text-xl text-teal-800">${term.name}</h3>
                        <p class="text-sm text-gray-700">${term.desc}</p>
                    </div>
                `;
            }).join('');

            const duplexOptions = Object.keys(termsData).slice(2).map(key => {
                const term = termsData[key];
                const activeClass = state.duplexMode === key ? 'bg-teal-600 text-white' : 'bg-white text-teal-600 hover:bg-teal-100';
                return `<button onclick="setMode('${key}')" class="px-4 py-2 rounded-lg font-bold transition-all ${activeClass}">${term.name}</button>`;
            }).join('');

            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Network Terminologies</h2>

                    <h3 class="font-bold text-xl text-gray-700 mb-4">Bandwidth and Throughput</h3>
                    <div class="space-y-4 mb-10">${termList.slice(0, 2)}</div>

                    <h3 class="font-bold text-xl text-gray-700 mb-4">Data Transmission Modes Interactive</h3>
                    <div class="bg-teal-100 p-6 rounded-xl">
                        <div class="flex justify-center space-x-2 mb-6">${duplexOptions}</div>
                        <div class="flex justify-around items-center h-20 relative">
                            <div class="text-center">
                                <i class="fas fa-laptop text-4xl text-gray-700"></i>
                                <p class="text-sm font-bold mt-1">Sender</p>
                            </div>
                            <div class="relative w-1/2 h-1 bg-gray-300 rounded-full flex items-center justify-center">
                                <i id="arrow-forward" class="fas fa-arrow-right text-teal-600 text-3xl absolute opacity-0 transition-opacity"></i>
                                <i id="arrow-backward" class="fas fa-arrow-left text-teal-600 text-3xl absolute opacity-0 transition-opacity"></i>
                                <i id="arrow-both" class="fas fa-arrows-alt-h text-teal-600 text-3xl absolute opacity-0 transition-opacity"></i>
                            </div>
                            <div class="text-center">
                                <i class="fas fa-server text-4xl text-gray-700"></i>
                                <p class="text-sm font-bold mt-1">Receiver</p>
                            </div>
                        </div>
                        <p id="mode-desc" class="text-center mt-6 text-sm italic text-gray-600">${termsData[state.duplexMode].desc}</p>
                    </div>

                    <h3 class="font-bold text-xl text-gray-700 mt-10 mb-4">Calculate Transmission Time</h3>
                    <div class="bg-gray-100 p-6 rounded-xl">
                        <label class="block mb-2 text-sm font-medium">Data Size (Bytes):</label>
                        <input type="number" id="data-size" value="10000" class="border p-2 rounded w-full mb-3">
                        <label class="block mb-2 text-sm font-medium">Bandwidth (bps):</label>
                        <input type="number" id="bandwidth" value="10000000" class="border p-2 rounded w-full mb-4">
                        <button onclick="calculateTime()" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-teal-700"><i class="fas fa-clock mr-2"></i>Calculate</button>
                        <p class="mt-4 text-sm font-bold text-gray-700">Time required: <span id="time-result" class="text-lg text-teal-600 ml-2">...</span></p>
                    </div>
                </div>
            `;
        }

        function renderHistory() {
            return `
                <div class="history-page fade-in-up p-8 md:p-12">
                    <h2 class="history-title text-4xl font-bold text-amber-900 mb-8 text-center">The Historical Evolution of Networking</h2>

                    <div class="history-text space-y-8">
                        <p class="drop-cap">The journey of computer networking began long before the modern internet. It traces its roots back to the **Telegraph** and **Telephone** systems, establishing the basic concepts of point-to-point and switched communication. However, the true foundation for modern networking was laid in the 1960s with the concept of **Packet Switching** by figures like Leonard Kleinrock, which was revolutionary as it allowed multiple conversations to share the same medium.</p>

                        <div class="md:grid grid-cols-3 gap-8">
                            <div class="col-span-2">
                                <h3 class="history-title text-2xl font-bold text-amber-800 mb-4">ARPANET and the Birth of the Internet</h3>
                                <p>The **ARPANET** (Advanced Research Projects Agency Network), established in 1969, is considered the precursor to the Internet. It was the first network to implement packet switching, connecting four university computers. Initially a project for resource sharing and communication robustness, it quickly proved the viability of decentralized communication.</p>
                                <p>A critical turning point was the development of the **TCP/IP** protocol suite in the 1970s, which standardized communication and allowed disparate networks to link together. This created the "Internet" (Inter-Networking). By 1983, TCP/IP became the standard protocol for ARPANET.</p>
                            </div>
                            <div class="illustration-box mt-4 md:mt-0">
                                <div class="illustration-pattern"></div>
                                <i class="illustration-icon fas fa-project-diagram"></i>
                                <p class="text-xs font-bold text-center text-gray-600">ARPANET: The first packets.</p>
                            </div>
                        </div>

                        <h3 class="history-title text-2xl font-bold text-amber-800 mb-4">The World Wide Web (WWW)</h3>
                        <p>While the Internet provided the *infrastructure* (the roads), the **World Wide Web** provided the *content* (the cars). Developed by **Tim Berners-Lee** at CERN in 1989, the WWW introduced **HTTP** (the protocol) and **HTML** (the language), making information easily navigable via **hypertext links**. The release of the Mosaic web browser in 1993 made the Web accessible to the public, leading to its explosive growth in the mid-1990s and transforming it from an academic tool into a global public utility.</p>

                        <h3 class="history-title text-2xl font-bold text-amber-800 mb-4">Modern Era: Wireless and Cloud</h3>
                        <p>The 21st century is defined by **Wireless Networks** (Wi-Fi, 4G/5G) and **Cloud Computing**. These innovations democratized access, making connectivity pervasive and allowing users to access powerful, scalable resources remotely. The continuous evolution focuses on higher speeds (fiber optics), lower latency, and increased security to support real-time applications like video conferencing and the Internet of Things (IoT).</p>
                    </div>
                </div>
            `;
        }

        // --- NEW: DEEP DIVE INDEX PAGE ---
        function renderDeepDive() {
            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Networking Deep Dive Topics</h2>
                    <p class="text-lg text-gray-600 mb-8">Explore key concepts in media, architecture, protocols, and cyber security.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${deepDiveBtn('media', '1. Transmission Media', 'Wired vs. Wireless (Guided vs. Unguided).', 'fa-broadcast-tower')}
                        ${deepDiveBtn('geo_class', '2. Geographical Spread', 'LAN, MAN, WAN classifications and scope.', 'fa-city')}
                        ${deepDiveBtn('topologies', '3. Network Topologies', 'Bus, Star, Ring, Mesh arrangements.', 'fa-project-diagram')}
                        ${deepDiveBtn('protocols', '4 & 6. Core Protocols & Chat', 'TCP/IP, FTP, HTTP, SMTP, POP3, and Real-Time Protocols.', 'fa-server')}
                        ${deepDiveBtn('telnet', '5. Remote Login (Telnet)', 'Unencrypted remote command-line access simulation.', 'fa-terminal')}
                        ${deepDiveBtn('web_tech', '7-9. Web Services & Languages', 'WWW, URL, HTML, XML, and Web Scripting.', 'fa-code')}
                        ${deepDiveBtn('security', '10. Network Security Concepts', 'Threats, Cyberlaw, and Protection Methods.', 'fa-shield-alt')}
                    </div>
                </div>
            `;
        }

        function deepDiveBtn(id, title, sub, icon) {
            return `
                <button onclick="nav('${id}')" class="w-full bg-indigo-50 border border-indigo-200 p-4 rounded-xl text-left transition-all btn-primary group hover:bg-indigo-600 hover:text-white">
                    <div class="flex items-center justify-between mb-1">
                        <div class="flex items-center">
                            <i class="fas ${icon} text-xl mr-3 text-indigo-600 group-hover:text-white transition-colors"></i>
                            <h3 class="font-bold text-lg">${title}</h3>
                        </div>
                        <i class="fas fa-chevron-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    </div>
                    <p class="text-sm opacity-70 group-hover:text-indigo-100">${sub}</p>
                </button>
            `;
        }

        // --- NEW: DEEP DIVE CONTENT PAGES (With Interactivity) ---

        function renderMedia() {
            const media = state.mediaType === 'Wired' ? {
                title: 'Wired (Guided) Media', icon: 'fa-link', color: 'blue', list: [
                    { name: 'Twisted Pair Cable', desc: 'Common, inexpensive (UTP/STP). Used in LANs. Prone to noise.' },
                    { name: 'Coaxial Cable', desc: 'Higher bandwidth than TP. Used in Cable TV and older networks. Better shielding.' },
                    { name: 'Fiber Optic Cable', desc: 'Highest bandwidth, uses light pulses. Immune to noise, longest distance.' },
                ]
            } : {
                title: 'Wireless (Unguided) Media', icon: 'fa-wifi', color: 'green', list: [
                    { name: 'Radio Waves', desc: 'Omnidirectional. Used for Wi-Fi, Bluetooth, cellular networks. Requires frequency allocation.' },
                    { name: 'Microwaves', desc: 'Unidirectional (line-of-sight). Used for long-distance communication and satellite links.' },
                    { name: 'Infrared', desc: 'Short-range, requires line-of-sight. Used in TV remotes. Cannot penetrate solid objects.' },
                ]
            };

            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">1. Transmission Media (Wired & Wireless)</h2>
                    <p class="text-lg text-gray-600 mb-6">The physical path over which data travels.</p>

                    <div class="flex justify-center mb-6 space-x-4">
                        <button onclick="setMediaType('Wired')" class="px-6 py-2 rounded-full font-bold transition-all ${state.mediaType === 'Wired' ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-blue-600 border border-blue-600'}">Wired (Guided)</button>
                        <button onclick="setMediaType('Wireless')" class="px-6 py-2 rounded-full font-bold transition-all ${state.mediaType === 'Wireless' ? 'bg-green-600 text-white shadow-lg' : 'bg-white text-green-600 border border-green-600'}">Wireless (Unguided)</button>
                    </div>

                    <div class="bg-${media.color}-50 p-6 rounded-xl border-l-4 border-${media.color}-500">
                        <h3 class="font-bold text-xl text-${media.color}-700 mb-3"><i class="fas ${media.icon} mr-2"></i>${media.title}</h3>
                        <ul class="space-y-3 text-gray-700 text-sm">
                            ${media.list.map(item => `
                                <li><strong>${item.name}:</strong> ${item.desc}</li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderGeoClass() {
             const descriptions = {
                LAN: 'Covers a small area like an office or building. **High-speed**, typically uses Ethernet/Wi-Fi. Privately owned.',
                MAN: 'Covers a city or large campus. Connects multiple LANs. Often uses fiber optics. Moderate speed.',
                WAN: 'Spans a country or the globe (like the Internet). Connects MANs/LANs. Lower speed, utilizes public carriers.',
            };

            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">2. Classification by Geographical Spread/Distance</h2>
                    <p class="text-lg text-gray-600 mb-8">Networks are categorized by the distance they cover, impacting speed and technology used.</p>

                    <div class="bg-gray-100 p-6 rounded-xl mb-6">
                        <h3 class="font-bold text-xl mb-4">Select Scope to View Details:</h3>
                        <div class="flex justify-around space-x-2">
                            <button onclick="setGeoScope('LAN')" class="flex-1 px-4 py-2 rounded-lg font-bold transition-all ${state.geoScope === 'LAN' ? 'bg-red-600 text-white shadow-md' : 'bg-white text-red-600 border border-red-600'}">LAN</button>
                            <button onclick="setGeoScope('MAN')" class="flex-1 px-4 py-2 rounded-lg font-bold transition-all ${state.geoScope === 'MAN' ? 'bg-yellow-600 text-white shadow-md' : 'bg-white text-yellow-600 border border-yellow-600'}">MAN</button>
                            <button onclick="setGeoScope('WAN')" class="flex-1 px-4 py-2 rounded-lg font-bold transition-all ${state.geoScope === 'WAN' ? 'bg-green-600 text-white shadow-md' : 'bg-white text-green-600 border border-green-600'}">WAN</button>
                        </div>
                    </div>

                    <div class="p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                        <h3 class="font-bold text-xl text-indigo-800 mb-1">${state.geoScope} (${state.geoScope === 'LAN' ? 'Local' : state.geoScope === 'MAN' ? 'Metropolitan' : 'Wide'} Area Network)</h3>
                        <p class="text-sm text-gray-700">${descriptions[state.geoScope]}</p>
                    </div>
                </div>
            `;
        }

        function renderTopologies() {
            const topologies = {
                Star: { desc: 'All nodes connect to a central hub/switch. **Pro:** Easy fault identification. **Con:** Central device failure brings down the network.', illustration: renderStarTopo() },
                Bus: { desc: 'All devices connect to a single central cable (backbone). **Pro:** Cheapest and simplest. **Con:** Single cable break splits the network.', illustration: renderBusTopo() },
                Ring: { desc: 'Nodes connect in a circle; data passes sequentially. **Pro:** Predictable performance. **Con:** Failure of one link/node disrupts the whole network.', illustration: renderRingTopo() },
                Mesh: { desc: 'Every device is connected to every other device (Full Mesh). **Pro:** Maximum redundancy and fault tolerance. **Con:** Extremely expensive and complex.', illustration: renderMeshTopo() },
            };

            const topo = topologies[state.selectedTopo];

            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">3. Network Topologies and Their Uses</h2>
                    <p class="text-lg text-gray-600 mb-6">The physical or logical arrangement of connections (nodes and links) in a network.</p>

                    <div class="bg-gray-100 p-6 rounded-xl mb-6">
                        <h3 class="font-bold text-xl mb-4">Select Topology:</h3>
                        <div class="flex flex-wrap justify-center gap-2">
                            ${Object.keys(topologies).map(key => `
                                <button onclick="setTopology('${key}')" class="px-4 py-2 rounded-lg font-bold transition-all ${state.selectedTopo === key ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-indigo-600 border border-indigo-600'}">${key}</button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl border-l-4 border-indigo-500 shadow-md">
                        <h3 class="font-bold text-2xl text-indigo-800 mb-3">${state.selectedTopo} Topology</h3>
                        <div class="mb-4 flex justify-center p-4 bg-gray-50 rounded-lg">
                            ${topo.illustration}
                        </div>
                        <p class="text-sm text-gray-700">${topo.desc}</p>
                    </div>
                </div>
            `;
        }

        function renderStarTopo() {
            return `
                <div class="topology-diagram">
                    <div class="topo-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                    <div class="topo-node" style="top: 10%; left: 50%;"></div>
                    <div class="topo-line" style="top: 50%; left: 50%; width: 2px; height: 40px; transform: translate(-1px, -70px) rotate(0deg);"></div>

                    <div class="topo-node" style="top: 50%; left: 85%;"></div>
                    <div class="topo-line" style="top: 50%; left: 50%; width: 50px; height: 2px; transform: translate(5px, 0px) rotate(0deg);"></div>

                    <div class="topo-node" style="top: 90%; left: 50%;"></div>
                    <div class="topo-line" style="top: 50%; left: 50%; width: 2px; height: 40px; transform: translate(-1px, 30px) rotate(0deg);"></div>

                    <div class="topo-node" style="top: 50%; left: 15%;"></div>
                    <div class="topo-line" style="top: 50%; left: 15%; width: 50px; height: 2px; transform: translate(15px, 0px) rotate(180deg);"></div>
                </div>
            `;
        }
        function renderBusTopo() {
            return `
                <div class="topology-diagram relative w-full">
                    <div class="topo-line absolute top-1/2 left-0 right-0 h-2 bg-gray-400 rounded-lg"></div>
                    <div class="topo-node" style="top: 50%; left: 10%; transform: translate(-50%, -50%);"></div>
                    <div class="topo-node" style="top: 50%; left: 35%; transform: translate(-50%, -50%);"></div>
                    <div class="topo-node" style="top: 50%; left: 65%; transform: translate(-50%, -50%);"></div>
                    <div class="topo-node" style="top: 50%; left: 90%; transform: translate(-50%, -50%);"></div>
                </div>
            `;
        }
        function renderRingTopo() {
            return `
                <div class="topology-diagram h-[150px] w-[150px] relative">
                    <div class="absolute inset-0 border-2 border-gray-400 rounded-full"></div>
                    <div class="topo-node" style="top: 0; left: 50%; transform: translate(-50%, -50%);"></div>
                    <div class="topo-node" style="top: 50%; right: 0; transform: translate(50%, -50%);"></div>
                    <div class="topo-node" style="bottom: 0; left: 50%; transform: translate(-50%, 50%);"></div>
                    <div class="topo-node" style="top: 50%; left: 0; transform: translate(-50%, -50%);"></div>
                </div>
            `;
        }
        function renderMeshTopo() {
            return `
                <div class="topology-diagram w-[150px] h-[150px] relative">
                    <div class="topo-node" style="top: 10%; left: 10%;">A</div>
                    <div class="topo-node" style="top: 10%; right: 10%;">B</div>
                    <div class="topo-node" style="bottom: 10%; left: 10%;">C</div>
                    <div class="topo-node" style="bottom: 10%; right: 10%;">D</div>

                    <!-- Lines (A-B, C-D, A-C, B-D, A-D, B-C) -->
                    <div class="topo-line" style="top: 10%; left: 10%; width: 80%; transform: translate(10px, 9px) rotate(0deg);"></div>
                    <div class="topo-line" style="top: 90%; left: 10%; width: 80%; transform: translate(10px, 9px) rotate(0deg);"></div>
                    <div class="topo-line" style="top: 10%; left: 10%; width: 80%; height: 2px; transform-origin: 0% 0%; transform: translate(9px, 10px) rotate(90deg);"></div>
                    <div class="topo-line" style="top: 10%; right: 10%; width: 80%; height: 2px; transform-origin: 100% 0%; transform: translate(-10px, 10px) rotate(90deg);"></div>

                    <div class="topo-line" style="top: 10%; left: 10%; width: 110px; height: 2px; transform-origin: 0% 0%; transform: translate(10px, 10px) rotate(45deg);"></div>
                    <div class="topo-line" style="top: 90%; left: 10%; width: 110px; height: 2px; transform-origin: 0% 0%; transform: translate(10px, 10px) rotate(-45deg);"></div>
                </div>
            `;
        }

        function protocolCard(abbr, name, desc, color) {
            const colors = {
                blue: 'border-blue-500 bg-blue-50 text-blue-800',
                green: 'border-green-500 bg-green-50 text-green-800',
                purple: 'border-purple-500 bg-purple-50 text-purple-800',
                orange: 'border-orange-500 bg-orange-50 text-orange-800',
                teal: 'border-teal-500 bg-teal-50 text-teal-800',
                yellow: 'border-yellow-500 bg-yellow-50 text-yellow-800',
            };
            return `
                <div class="p-4 border-l-4 ${colors[color]} rounded-lg">
                    <h4 class="font-extrabold text-lg">${abbr} <span class="text-sm font-normal">(${name})</span></h4>
                    <p class="text-sm mt-1">${desc}</p>
                </div>
            `;
        }

        function renderProtocols() {
            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">4 & 6. Core Network Protocols & Real-Time</h2>
                    <p class="text-lg text-gray-600 mb-8">Protocols define the rules for communication across the Internet.</p>

                    <div class="space-y-4">
                        <h3 class="font-bold text-xl text-gray-700 mt-6">Foundational & Application Protocols</h3>
                        ${protocolCard('TCP/IP', 'Transmission Control Protocol/Internet Protocol', 'The foundation of the Internet. IP handles addressing/routing (L3); TCP handles reliable, connection-oriented data transfer (L4).', 'blue')}
                        ${protocolCard('FTP', 'File Transfer Protocol', 'Standard protocol for transferring computer files between a client and server (e.g., uploading files).', 'green')}
                        ${protocolCard('HTTP', 'Hypertext Transfer Protocol', 'The basis for the World Wide Web. Used by browsers to request web pages and resources.', 'purple')}

                        <h3 class="font-bold text-xl text-gray-700 mt-8">Mail and Connection Protocols</h3>
                        ${protocolCard('SMTP', 'Simple Mail Transfer Protocol', 'Used for sending email messages across networks (Outgoing Mail).', 'orange')}
                        ${protocolCard('POP3', 'Post Office Protocol version 3', 'Used by clients to retrieve email messages from a mail server (Incoming Mail, downloads messages).', 'teal')}
                        ${protocolCard('PPP', 'Point-to-Point Protocol', 'A Data Link Layer (L2) protocol used to establish a direct connection between two nodes (e.g., dial-up/DSL).', 'yellow')}

                        <h3 class="font-bold text-xl text-gray-700 mt-8">Protocols for Chat and Video Conferencing (Real-Time)</h3>
                        <div class="p-4 border-l-4 border-indigo-500 bg-indigo-50 text-indigo-800 rounded-lg">
                            <p class="text-sm mt-1">Protocols like **VoIP (Voice over IP)**, which often relies on **SIP (Session Initiation Protocol)** or **H.323**, and transport protocols like **RTP (Real-time Transport Protocol)** are used to manage and transmit streaming media effectively, prioritizing speed over guaranteed delivery.</p>
                            <button onclick="nav('switching')" class="mt-3 bg-indigo-700 text-white text-xs px-3 py-1 rounded hover:bg-indigo-800"><i class="fas fa-random mr-1"></i> See Packet Switching</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTelnet() {
            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">5. Remote Login (Telnet) Simulation</h2>
                    <p class="text-lg text-gray-600 mb-6">Telnet is an application layer protocol used to provide bidirectional interactive text-oriented communication facility using a virtual terminal connection. **It is highly insecure as it transmits all data (including passwords) in plaintext.**</p>

                    <h3 class="font-bold text-2xl text-gray-800 mb-4">Simulated Terminal Session</h3>
                    <div class="terminal" id="telnet-output">
                        Welcome to the Telnet Server (simulated).
                        <br>Authentication required.
                        <br>login: <span style="color: yellow;">student</span>
                        <br>password: <span style="color: red;">********</span> (Sent in plaintext!)
                        <br>Access granted. Type 'help' or 'ls'. Type 'quit' to close.
                        <br>
                    </div>
                    <div class="flex mt-4">
                        <span class="terminal-prompt text-sm text-green-500 mr-2"></span>
                        <input type="text" id="telnet-input" class="bg-black text-green-500 font-mono flex-grow border-none focus:ring-0 p-0 text-sm" onkeydown="handleTelnetInput(event)" autofocus>
                    </div>
                </div>
            `;
        }

        function handleTelnetInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('telnet-input');
                const output = document.getElementById('telnet-output');
                const command = input.value.trim().toLowerCase();

                output.innerHTML += `<br><span class="text-green-500">user@remote-server:~> </span>${input.value}`;

                let response = '';
                switch(command) {
                    case 'ls':
                        response = 'network_files.txt  config.ini  secret_passwords.log';
                        break;
                    case 'help':
                        response = 'Available commands: ls, whoami, ping, quit.';
                        break;
                    case 'whoami':
                        response = 'You are currently logged in as student.';
                        break;
                    case 'ping':
                        response = 'Pinging 192.168.1.2... Reply from 192.168.1.2: bytes=32 time=4ms TTL=64.';
                        break;
                    case 'quit':
                        response = 'Closing connection... Goodbye.';
                        input.disabled = true;
                        break;
                    default:
                        response = `Command not found: ${command}.`;
                }

                if (response) {
                    output.innerHTML += `<br>${response}`;
                }

                output.scrollTop = output.scrollHeight;
                input.value = '';
                event.preventDefault();
            }
        }

        function renderWebTech() {
            const clientSide = [
                { name: 'JavaScript', desc: 'Runs in the userâ€™s browser. Used for dynamic content, interactivity, and form validation.' },
                { name: 'DHTML', desc: 'A combination of HTML, CSS, and JavaScript to create dynamic effects without server intervention.' }
            ];
            const serverSide = [
                { name: 'PHP, Python, Java', desc: 'Runs on the web server. Used for database interaction, complex application logic, and session management.' },
                { name: 'XML', desc: 'A language designed to transport and store data, primarily used for data exchange between systems.' }
            ];
            const activeScripting = state.scriptingType === 'Server' ? serverSide : clientSide;

            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">7, 8, 9. Web Services, Languages, & Scripting</h2>
                    <p class="text-lg text-gray-600 mb-8">The core technologies that power the interactive World Wide Web.</p>

                    <!-- Web Services (WWW, HTTP, URL) -->
                    <div class="bg-gray-100 p-6 rounded-xl mb-6 border-l-4 border-indigo-400">
                        <h3 class="font-bold text-xl text-indigo-700 mb-3"><i class="fas fa-globe mr-2"></i>Web Services</h3>
                        <ul class="space-y-2 text-gray-700 text-sm pl-4 list-disc">
                            <li><strong>WWW:</strong> A system of interconnected hypertext documents (the content layer).</li>
                            <li><strong>HTTP:</strong> Protocol for transferring web content (the rules).</li>
                            <li><strong>URL:</strong> The unique address of a resource (the location).</li>
                            <li><strong>HTML:</strong> The primary markup language for structuring content.</li>
                        </ul>
                    </div>

                    <!-- Web Scripting Interactive Toggle -->
                    <div class="bg-indigo-50 p-6 rounded-xl border-l-4 border-indigo-500">
                        <h3 class="font-bold text-xl text-indigo-800 mb-3"><i class="fas fa-terminal mr-2"></i>Web Scripting</h3>
                        <div class="flex justify-center mb-4 space-x-4">
                            <button onclick="setScriptingType('Client')" class="px-4 py-2 rounded-lg font-bold transition-all ${state.scriptingType === 'Client' ? 'bg-indigo-700 text-white shadow-md' : 'bg-white text-indigo-700 border border-indigo-700'}">Client-Side</button>
                            <button onclick="setScriptingType('Server')" class="px-4 py-2 rounded-lg font-bold transition-all ${state.scriptingType === 'Server' ? 'bg-indigo-700 text-white shadow-md' : 'bg-white text-indigo-700 border border-indigo-700'}">Server-Side</button>
                        </div>

                        <p class="font-bold text-base text-indigo-800 mb-2">${state.scriptingType}-Side Focus:</p>
                        <ul class="space-y-2 text-gray-700 text-sm pl-4 list-disc">
                            ${activeScripting.map(item => `
                                <li><strong>${item.name}:</strong> ${item.desc}</li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderSecurity() {
            return `
                <div class="fade-in-up">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">10. Network Security Concepts</h2>
                    <p class="text-lg text-gray-600 mb-8">Protecting digital assets, data, and users from threats and unauthorized access.</p>

                    <!-- Threats -->
                    <div class="bg-red-50 p-6 rounded-xl mb-6 border-l-4 border-red-500">
                        <h3 class="font-bold text-xl text-red-700 mb-3"><i class="fas fa-bug mr-2"></i>Malicious Software (Malware)</h3>
                        <ul class="space-y-2 text-gray-700 text-sm pl-4 list-disc">
                            <li><strong>Virus:</strong> Spreads by attaching to clean files; requires human execution.</li>
                            <li><strong>Worm:</strong> Self-replicating, spreads autonomously across networks.</li>
                            <li><strong>Trojan Horse:</strong> Disguised as legitimate software to create backdoors.</li>
                            <li><strong>Mobile Banking Terms:</strong> (e.g., OTP, Phishing, Smishing) Refer to textbook for current curriculum specifics.</li>
                        </ul>
                    </div>

                    <!-- Legal and Cybercrime -->
                    <div class="bg-yellow-50 p-6 rounded-xl mb-6 border-l-4 border-yellow-500">
                        <h3 class="font-bold text-xl text-yellow-700 mb-3"><i class="fas fa-gavel mr-2"></i>Cyberlaw, IT Act, IPR & Cyber Crimes</h3>
                        <ul class="space-y-2 text-gray-700 text-sm pl-4 list-disc">
                            <li><strong>Cyberlaw/IT Act:</strong> Legal framework governing electronic transactions and cybercrime.</li>
                            <li><strong>IPR (Intellectual Property Rights):</strong> Legal protection for original works (software, content).</li>
                            <li><strong>Classification of Cyber Crimes:</strong> Hacking, Identity Theft, Phishing, DoS attacks.</li>
                        </ul>
                    </div>

                    <!-- Protection Methods (Interactive) -->
                    <div class="bg-green-50 p-6 rounded-xl border-l-4 border-green-500">
                        <h3 class="font-bold text-xl text-green-700 mb-3"><i class="fas fa-user-lock mr-2"></i>Protection Methods</h3>
                        <p class="text-sm italic mb-4">Click a protection method to see its core function.</p>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="showSecurityDesc('firewall', 'A system that monitors and controls incoming and outgoing network traffic based on predetermined security rules.')" class="bg-white text-green-600 border border-green-300 hover:bg-green-100 py-2 rounded-lg text-sm font-bold">Firewall</button>
                            <button onclick="showSecurityDesc('encryption', 'The process of converting information into a code to prevent unauthorized access. (E.g., SSL/TLS for HTTPs)')" class="bg-white text-green-600 border border-green-300 hover:bg-green-100 py-2 rounded-lg text-sm font-bold">Encryption</button>
                            <button onclick="showSecurityDesc('antivirus', 'Software designed to detect, prevent, and remove malicious software from computer systems.')" class="bg-white text-green-600 border border-green-300 hover:bg-green-100 py-2 rounded-lg text-sm font-bold">Antivirus</button>
                            <button onclick="showSecurityDesc('mfa', 'Using two or more verification methods to grant access, greatly enhancing security.')" class="bg-white text-green-600 border border-green-300 hover:bg-green-100 py-2 rounded-lg text-sm font-bold">MFA (2FA/Multi-Factor)</button>
                        </div>
                        <p id="security-desc" class="mt-4 text-sm text-gray-700 italic">Click a button above to learn more.</p>
                    </div>
                </div>
            `;
        }

        // --- INTERACTIVE LOGIC (Restored & New) ---

        window.setMediaType = function(type) {
            state.mediaType = type;
            render();
        }

        window.setGeoScope = function(scope) {
            state.geoScope = scope;
            render();
        }

        window.setTopology = function(topo) {
            state.selectedTopo = topo;
            render();
        }

        window.setScriptingType = function(type) {
            state.scriptingType = type;
            render();
        }

        window.showSecurityDesc = function(key, desc) {
            document.getElementById('security-desc').innerHTML = `<strong>${key.toUpperCase()}:</strong> ${desc}`;
        }

        window.setMode = function(mode) {
            state.duplexMode = mode;
            render();
            const arrowForward = document.getElementById('arrow-forward');
            const arrowBackward = document.getElementById('arrow-backward');
            const arrowBoth = document.getElementById('arrow-both');
            const modeDesc = document.getElementById('mode-desc');

            arrowForward.classList.add('opacity-0');
            arrowBackward.classList.add('opacity-0');
            arrowBoth.classList.add('opacity-0');

            switch(mode) {
                case 'simplex':
                    arrowForward.classList.remove('opacity-0');
                    break;
                case 'halfDuplex':
                    animateArrow(arrowForward, 'forward', 1000, true);
                    animateArrow(arrowBackward, 'backward', 1000, true);
                    break;
                case 'fullDuplex':
                    arrowBoth.classList.remove('opacity-0');
                    break;
            }
             modeDesc.innerText = termsData[mode].desc;
        }

        function animateArrow(el, dir, duration, repeat = false) {
            el.classList.add('opacity-100');
            el.style.transition = `transform ${duration/1000}s ease-in-out`;

            let currentX = dir === 'forward' ? '-100%' : '100%';
            let targetX = dir === 'forward' ? '100%' : '-100%';

            function frame() {
                el.style.transform = `translateX(${targetX})`;
                setTimeout(() => {
                     el.style.transition = 'none';
                     el.style.transform = `translateX(${currentX})`;
                     setTimeout(() => {
                        el.style.transition = `transform ${duration/1000}s ease-in-out`;
                        if (repeat) frame();
                    }, 50);
                }, duration);
            }
            frame();
        }

        window.calculateTime = function() {
            const dataSize = parseFloat(document.getElementById('data-size').value) * 8; // Bytes to Bits
            const bandwidth = parseFloat(document.getElementById('bandwidth').value); // bps

            if (isNaN(dataSize) || isNaN(bandwidth) || bandwidth === 0) {
                document.getElementById('time-result').innerText = 'Invalid input.';
                return;
            }

            const time = (dataSize / bandwidth).toFixed(6); // Time in seconds
            document.getElementById('time-result').innerText = `${time} seconds`;
        }

        window.checkIP = function(inputId, outputId) {
            const ip = document.getElementById(inputId).value.trim();
            const output = document.getElementById(outputId);
            const octets = ip.split('.').map(Number);

            if (octets.length !== 4 || octets.some(o => isNaN(o) || o < 0 || o > 255)) {
                output.className = 'text-red-600';
                output.innerText = 'Invalid IP Format. Must be four octets (0-255).';
                return;
            }

            const firstOctet = octets[0];
            let ipClass = '';
            let color = '';

            if (firstOctet >= 1 && firstOctet <= 126) {
                ipClass = 'Class A (Large Networks)';
                color = 'green';
            } else if (firstOctet >= 128 && firstOctet <= 191) {
                ipClass = 'Class B (Medium Networks)';
                color = 'blue';
            } else if (firstOctet >= 192 && firstOctet <= 223) {
                ipClass = 'Class C (Small Networks)';
                color = 'purple';
            } else if (firstOctet >= 224 && firstOctet <= 239) {
                ipClass = 'Class D (Multicast)';
                color = 'orange';
            } else if (firstOctet >= 240 && firstOctet <= 255) {
                ipClass = 'Class E (Experimental)';
                color = 'red';
            } else {
                 ipClass = 'Reserved (e.g., 0.x.x.x or 127.x.x.x Loopback)';
                color = 'gray';
            }

            output.className = `text-${color}-600`;
            output.innerText = `The IP Address ${ip} belongs to ${ipClass}.`;
        }

        function generateRandomMAC() {
            const hexDigits = '0123456789ABCDEF';
            let mac = '';
            for (let i = 0; i < 12; i++) {
                mac += hexDigits[Math.floor(Math.random() * 16)];
                if (i % 2 === 1 && i < 11) mac += ':';
            }
            return mac;
        }

        function simpleCaesar(text, shift) {
            return text.split('').map(char => {
                const charCode = char.charCodeAt(0);
                if (charCode >= 65 && charCode <= 90) { // Uppercase
                    return String.fromCharCode(((charCode - 65 + shift) % 26) + 65);
                } else if (charCode >= 97 && charCode <= 122) { // Lowercase
                    return String.fromCharCode(((charCode - 97 + shift) % 26) + 97);
                }
                return char;
            }).join('');
        }

        window.simulateHTTP = function(id) {
            const output = document.getElementById(id);
            output.innerText = 'Sending: GET /index.html HTTP/1.1...';
            setTimeout(() => {
                output.innerText = 'Server Reply: HTTP/1.1 200 OK (Returning HTML content)';
            }, 1500);
        }

        window.encryptText = function(inputId, resultId) {
            const input = document.getElementById(inputId).value;
            const output = document.getElementById(resultId);
            if (!input) { output.innerText = "Please enter text to encrypt."; return; }
            const encrypted = simpleCaesar(input, 3); // Shift by 3
            output.innerText = encrypted;
        }

        window.toggleSession = function(id) {
            const output = document.getElementById(id);
            if (output.innerText.includes('CLOSED')) {
                output.innerText = 'Session: ESTABLISHED (Data can flow)';
                output.classList.remove('text-red-600');
                output.classList.add('text-green-600');
            } else {
                output.innerText = 'Session: CLOSED';
                output.classList.remove('text-green-600');
                output.classList.add('text-red-600');
            }
        }

        window.simulateTCP = function(id) {
            const output = document.getElementById(id);
            output.innerText = 'Starting Three-Way Handshake (SYN, SYN-ACK, ACK)...';
            setTimeout(() => {
                output.innerText = 'Connection Established. Sending Segment 1... ACK Received.';
            }, 1000);
            setTimeout(() => {
                output.innerText = 'Sending Segment 2... ACK Received. Transfer Complete.';
            }, 2500);
        }

        window.simulateUDP = function(id) {
            const output = document.getElementById(id);
            output.innerText = 'Sending Datagram 1, 2, 3...';
            setTimeout(() => {
                output.innerText = 'Transfer Complete. No ACK requested. (Fast, but unreliable)';
            }, 1000);
        }

        window.lookupRoute = function(inputId, resultId) {
            const ip = document.getElementById(inputId).value.trim();
            const output = document.getElementById(resultId);
            if (!ip) { output.innerText = "Please enter an IP address."; return; }

            if (ip.startsWith('192.168.') || ip.startsWith('10.')) {
                output.innerText = `IP is local. Next Hop: Default Gateway (192.168.1.1).`;
            } else if (ip === '8.8.8.8') {
                output.innerText = `IP is external (Google DNS). Next Hop: ISP Router (e.g., 203.0.113.1).`;
            } else {
                output.innerText = `Checking Routing Table... Next Hop: Best external route found.`;
            }
        }

        window.createFrame = function(id) {
            const output = document.getElementById(id);
            const src = document.getElementById('l2-src-mac').innerText;
            const dst = document.getElementById('l2-dst-mac').innerText;
            output.innerText = `[Preamble][${dst} (Dest MAC)][${src} (Src MAC)][Length/Type][Data...][FCS/CRC (Error Check)]`;
        }

        window.transmitBits = function(id) {
            const output = document.getElementById(id);
            const bits = Array.from({length: 10}, () => Math.round(Math.random())).join('');
            output.innerHTML = bits.split('').map(b => `<span style="color:${b==='1'?'red':'blue'};">${b}</span>`).join('');
            setTimeout(() => {
                output.innerText = '... Signal received on the other end.';
            }, 1000);
        }

        window.generateMAC = function(id) {
            document.getElementById(id).innerText = generateRandomMAC();
        }

        let macTable = [
            { mac: generateRandomMAC(), port: 1 },
            { mac: generateRandomMAC(), port: 2 }
        ];

        window.learnMAC = function(id) {
            const newMac = generateRandomMAC();
            const newPort = macTable.length + 1;
            macTable.push({ mac: newMac, port: newPort });

            const output = document.getElementById(id);
            output.innerHTML = macTable.map(entry => `
                <p class="font-mono text-xs">${entry.mac} $\to$ Port ${entry.port}</p>
            `).join('');
        }

        window.routePacket = function(inputId, resultId) {
            const ip = document.getElementById(inputId).value.trim();
            const output = document.getElementById(resultId);

            if (!ip) {
                output.innerText = 'Enter an IP to check the routing.';
                return;
            }

            const octets = ip.split('.').map(Number);

            if (octets[0] >= 1 && octets[0] <= 126) {
                output.innerText = `Packet for Class A. Routed to core network interface 1.`;
            } else if (octets[0] >= 192 && octets[0] <= 223) {
                 output.innerText = `Packet for Class C. Routed to local interface 2.`;
            } else {
                output.innerText = `Packet routed to Default Gateway for external transmission.`;
            }
        }

        let isDigital = true;
        window.toggleModem = function(statusId, iconId, signalId) {
            isDigital = !isDigital;
            document.getElementById(statusId).innerText = isDigital ? 'Digital Signal' : 'Analog Signal (Line)';
            document.getElementById(signalId).innerText = isDigital ? 'Analog Signal (Line)' : 'Digital Signal';
            document.getElementById(iconId).className = isDigital ? 'fas fa-arrow-right text-2xl text-gray-500' : 'fas fa-arrow-left text-2xl text-gray-500';
        }

        let protocolIndex = 0;
        const protocols = ["HTTP", "FTP", "SMTP", "DNS", "IMAP"];
        window.translateProtocol = function(id) {
            const output = document.getElementById(id);
            protocolIndex = (protocolIndex + 1) % protocols.length;
            output.innerText = protocols[protocolIndex];
        }

        window.initSwitchingCanvas = function() {}; // Placeholder
        window.runSwitchSim = function(mode) {
            const status = document.getElementById('sim-status');
            const nodes = ['node-1','node-2','node-3'];

            // Reset
            nodes.forEach(n => document.getElementById(n).classList.remove('active', 'bg-orange-500', 'bg-blue-500', 'border-orange-600', 'text-white'));

            if (mode === 'circuit') {
                status.innerText = "Establishing dedicated circuit via Node 2...";
                status.className = "absolute bottom-2 left-0 right-0 text-center text-xs text-orange-400 font-bold";

                setTimeout(() => {
                    document.getElementById('node-2').classList.add('active', 'bg-orange-500', 'border-orange-600', 'text-white');
                    status.innerText = "Circuit Established. Transmitting Data stream...";
                }, 500);
                setTimeout(() => {
                     status.innerText = "Data Transfer Complete. Tear down circuit.";
                     document.getElementById('node-2').classList.remove('active', 'bg-orange-500', 'border-orange-600', 'text-white');
                }, 2000);
            } else {
                status.innerText = "Packetizing data...";
                status.className = "absolute bottom-2 left-0 right-0 text-center text-xs text-blue-400 font-bold";

                setTimeout(() => {
                    document.getElementById('node-1').classList.add('active', 'bg-blue-500', 'text-white');
                    status.innerText = "Packet 1 -> Node 1 (Route 1)";
                }, 500);
                setTimeout(() => {
                    document.getElementById('node-3').classList.add('active', 'bg-blue-500', 'text-white');
                    status.innerText = "Packet 2 -> Node 3 (Route 2)";
                }, 1000);
                setTimeout(() => {
                    document.getElementById('node-2').classList.add('active', 'bg-blue-500', 'text-white');
                     status.innerText = "Packet 3 -> Node 2 (Route 3). Reassembling at B.";
                }, 1500);
                 setTimeout(() => {
                    nodes.forEach(n => document.getElementById(n).classList.remove('active', 'bg-orange-500', 'bg-blue-500', 'border-orange-600', 'text-white'));
                     status.innerText = "Transfer Complete. All packets reassembled.";
                }, 2500);
            }
        };

        // Init
        window.onload = function() {
            render();
            // Need to call setMode manually after initial render to show the correct arrow for Simplex
            if (state.page === 'terms') {
                setMode(state.duplexMode);
            }
        };


    </script>
</body>
</html>